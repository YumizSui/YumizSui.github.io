---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntry } from 'astro:content';

const cvData = await getEntry('cv', 'cv');
const cv = cvData.data;
const title = 'CV';
const description = 'Curriculum Vitae';

// Filter for English version
const awards = cv.awards.filter(item => item.showInEnglish);
const grants = cv.grants.filter(item => item.showInEnglish);
const internships = cv.internships.filter(item => item.showInEnglish);
const teaching = cv.teaching.filter(item => item.showInEnglish);
const products = cv.products.filter(item => item.showInEnglish);
const talks = cv.talks.filter(item => item.showInEnglish);
const organization = cv.organization.filter(item => item.showInEnglish);
---

<BaseLayout title={title} description={description} lang="en">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-4xl font-bold mb-8">CV</h1>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Awards</h2>
        <ul class="space-y-2 list-disc list-inside">
          {awards.map((award) => (
            <li class="text-gray-700 dark:text-gray-300">
              <span class="font-semibold">{award.nameEn || award.name}</span> ({award.year})
            </li>
          ))}
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Scholarships and Grants</h2>
        <div class="space-y-6">
          {grants.map((grant) => (
            <div>
              <p class="font-semibold text-gray-900 dark:text-gray-100">{grant.period}</p>
              <p class="text-gray-700 dark:text-gray-300">
                {grant.nameEn || grant.name}
                {grant.grantNumber && <span class="text-sm"> [{grant.grantNumber}]</span>}
              </p>
              {(grant.nameEn || grant.name).includes('DC1') && (
                <p class="text-xs text-gray-600 dark:text-gray-400">Japan Society for the Promotion of Science (JSPS)</p>
              )}
              {(grant.nameEn || grant.name).includes('ACT-X') && (
                <p class="text-xs text-gray-600 dark:text-gray-400">Japan Science and Technology Agency (JST)</p>
              )}
              {(grant.nameEn || grant.name).includes('JASSO') && (
                <p class="text-xs text-gray-600 dark:text-gray-400">Japan Student Services Organization (JASSO)</p>
              )}
              {grant.projectEn && (
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  {grant.url ? (
                    <a href={grant.url} target="_blank" rel="noopener noreferrer" class="hover:underline">
                      {grant.projectEn}
                    </a>
                  ) : (
                    grant.projectEn
                  )}
                </p>
              )}
            </div>
          ))}
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Internship</h2>
        <div class="space-y-4">
          {internships.map((internship) => (
            <div>
              <p class="font-semibold text-gray-900 dark:text-gray-100">{internship.period}</p>
              <p class="text-gray-700 dark:text-gray-300">{internship.company} {internship.positionEn || internship.position}</p>
              {internship.url && (
                <p class="text-sm">
                  <a href={internship.url} target="_blank" rel="noopener noreferrer" class="hover:underline">
                    {internship.urlTitleEn ? `Tech Blog: ${internship.urlTitleEn}` : 'Tech Blog'}
                  </a>
                </p>
              )}
            </div>
          ))}
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Teaching</h2>
        <ul class="space-y-3">
          {teaching.map((item) => (
            <li class="text-gray-700 dark:text-gray-300">
              <span class="font-semibold">{item.year}</span> {item.titleEn || item.title}
              {item.url && (
                <a href={item.url} target="_blank" rel="noopener noreferrer" class="hover:underline ml-2">
                  [Link]
                </a>
              )}
              {item.videoUrl && (
                <a href={item.videoUrl} target="_blank" rel="noopener noreferrer" class="hover:underline ml-2">
                  [Video]
                </a>
              )}
            </li>
          ))}
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Products</h2>
        <ul class="space-y-2 list-disc list-inside">
          {products.map((product) => (
            <li class="text-gray-700 dark:text-gray-300">
              <a href={product.url} target="_blank" rel="noopener noreferrer" class="hover:underline font-semibold">
                {product.name}
              </a>
              {' '}{product.year}
            </li>
          ))}
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Talks</h2>
        <div class="space-y-4">
          {talks.map((talk) => (
            <div>
              <p class="font-semibold text-gray-900 dark:text-gray-100">
                {talk.year} - {talk.eventEn || talk.event}
              </p>
              {talk.url ? (
                <p class="text-gray-700 dark:text-gray-300">
                  <a href={talk.url} target="_blank" rel="noopener noreferrer" class="hover:underline">
                    {talk.titleEn || talk.title}
                  </a>
                </p>
              ) : (
                <p class="text-gray-700 dark:text-gray-300">{talk.titleEn || talk.title}</p>
              )}
              {talk.noteEn && <p class="text-sm text-gray-600 dark:text-gray-400 italic">{talk.noteEn}</p>}
            </div>
          ))}
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 border-b-2 border-primary-light dark:border-primary-dark pb-2">Organization of Meetings</h2>
        <ul class="space-y-3">
          {organization.map((item) => (
            <li class="text-gray-700 dark:text-gray-300">
              <span class="font-semibold">{item.year}</span> - {item.eventEn || item.event}
              {item.locationEn && <span> ({item.locationEn})</span>}
              {item.date && <span> {item.date}</span>}
              {item.url && (
                <a href={item.url} target="_blank" rel="noopener noreferrer" class="hover:underline ml-2">
                  [Link]
                </a>
              )}
            </li>
          ))}
        </ul>
      </section>
    </div>
  </div>
</BaseLayout>
